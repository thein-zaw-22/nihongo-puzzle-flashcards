<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Japanese Flashcards</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    {% from 'nav.html' import nav_menu %}
    {{ nav_menu('flashcard') }}
    
    <div class="container">
        <h1>Japanese Flashcards</h1>
        <div class="flashcard-toolbar">
            <form method="post" style="display:inline; margin:0;">
                <button class="btn-toggle {% if shuffle %}is-on{% endif %}" name="shuffle_toggle" value="1" type="submit" aria-pressed="{{ 'true' if shuffle else 'false' }}">
                    <span class="toggle-dot" aria-hidden="true"></span>
                    <span class="toggle-label">Shuffle</span>
                    <span class="state-text">{% if shuffle %}On{% else %}Off{% endif %}</span>
                </button>
            </form>
            <form method="post" style="display:inline; margin:0;">
                <button class="btn-ghost" name="reshuffle" value="1" type="submit" {% if not shuffle %}disabled{% endif %}>
                    Reshuffle
                </button>
            </form>
        </div>
        <div class="flashcard-instructions">
            <span class="flip-icon" aria-hidden="true">üîÑ</span> Click or press <kbd>Space</kbd>/<kbd>Enter</kbd> to flip the card &nbsp;|&nbsp; <kbd>‚Üê</kbd>/<kbd>‚Üí</kbd> for Previous/Next
        </div>
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" style="width: {{ ((current_index + 1) / total_cards * 100) | round }}%;"></div>
            </div>
            <div class="progress-text">Card {{ current_index + 1 }} of {{ total_cards }}</div>
        </div>
        <div class="flashcard-study-area">
            <div class="flashcard-container">
                <div class="flashcard" id="flashcard" tabindex="0" aria-label="Flashcard. Press space or enter to flip."
                    onclick="this.classList.toggle('is-flipped')"
                    onkeydown="if(event.key===' '||event.key==='Enter'){event.preventDefault();this.classList.toggle('is-flipped');}">
                    <div class="flashcard-front">
                        <span class="flashcard-content">{{ card.front }}</span>
                        <span class="flip-hint">üîÑ</span>
                    </div>
                    <div class="flashcard-back">
                        <span class="flashcard-content">{{ card.back }}</span>
                        <span class="flip-hint">üîÑ</span>
                    </div>
                </div>
            </div>
            <div class="flashcard-controls">
                <form method="post" id="prevForm" style="display: inline;">
                    <button class="control-btn" id="prevBtn" name="prev" value="1" {% if current_index == 0 %}disabled{% endif %}>‚Üê Previous</button>
                </form>
                <form method="post" id="nextForm" style="display: inline;">
                    <button class="control-btn" id="nextBtn" name="next" value="1" {% if current_index == total_cards - 1 %}disabled{% endif %}>Next ‚Üí</button>
                </form>
    <script>
    // Keyboard navigation + global flip for flashcards
    document.addEventListener('DOMContentLoaded', function() {
        const flashcard = document.getElementById('flashcard');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const prevForm = document.getElementById('prevForm');
        const nextForm = document.getElementById('nextForm');
        document.addEventListener('keydown', function(e) {
            if (e.altKey || e.ctrlKey || e.metaKey) return;
            // Global flip on Space/Enter unless in an interactive control
            const inInteractive = e.target && (e.target.closest && e.target.closest('button, a, input, textarea, select, [contenteditable="true"]'));
            if ((e.key === ' ' || e.key === 'Spacebar' || e.key === 'Enter') && !inInteractive) {
                e.preventDefault();
                if (flashcard) {
                    flashcard.classList.toggle('is-flipped');
                }
                return;
            }
            if (e.key === 'ArrowLeft' && prevBtn && !prevBtn.disabled) {
                e.preventDefault();
                if (prevForm.requestSubmit) {
                    prevForm.requestSubmit(prevBtn);
                } else {
                    prevBtn.click();
                }
            } else if (e.key === 'ArrowRight' && nextBtn && !nextBtn.disabled) {
                e.preventDefault();
                if (nextForm.requestSubmit) {
                    nextForm.requestSubmit(nextBtn);
                } else {
                    nextBtn.click();
                }
            }
        });
    });
    </script>
            </div>
            {% if current_index + 1 == total_cards %}
                <div class="completion-message">üéâ You've reached the last card! Review again or go back to menu.</div>
                <form method="post" style="margin-top: 1rem;">
                    <button class="reset-btn" name="reset" value="1" type="submit">üîÑ Reset to First Card</button>
                </form>
            {% endif %}
        </div>
    </div>
</body>
</html>
